<!doctype html>
<html lang="zh-CN"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>PushFile Admin</title>
<link rel="stylesheet" href="{{ base }}/static/admin/style.css">
</head><body>
<div class="page">
  <div class="nav">
    <h1>PushFile Admin</h1>
    <span class="badge" id="connBadge">未连接</span>
  </div>

  <!-- Login -->
  <div id="loginSection">
    <div class="group">
      <div class="group-label">连接</div>
      <div class="group-box">
        <div class="row">
          <span class="row-label">密码</span>
          <input id="secret" type="password" placeholder="输入管理密码">
        </div>
      </div>
    </div>
    <button class="btn btn-blue" onclick="connect()" style="margin-bottom:20px">连接</button>

    <div class="group">
      <div class="group-label">新建相册</div>
      <div class="group-box">
        <div class="row">
          <span class="row-label">名称</span>
          <input id="newTokenInput" type="text" placeholder="英文标识，如 trip-tokyo">
        </div>
      </div>
    </div>
    <button class="btn btn-gray" onclick="createToken()" style="margin-bottom:20px">创建相册</button>

    <div class="group" style="margin-top:24px">
      <div class="group-label">使用说明</div>
      <div class="group-box">
        <div class="steps">
          <div class="step"><div class="step-num">1</div><div class="step-text"><b>创建相册</b><span>输入英文名称作为标识，如 wedding2026、trip-tokyo</span></div></div>
          <div class="step"><div class="step-num">2</div><div class="step-text"><b>上传照片</b><span>选择相册后点击上传区域，支持 JPG/PNG/GIF/WebP</span></div></div>
          <div class="step"><div class="step-num">3</div><div class="step-text"><b>分享链接</b><span>复制链接发给朋友，打开即可查看和下载照片</span></div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main (hidden until connected) -->
  <div id="mainSection" style="display:none">
    <div class="group">
      <div class="group-label">导入 ZIP</div>
      <div class="zip-zone" id="zipZone" onclick="document.getElementById('zipInput').click()">
        <p>📦 点击选择或拖拽 ZIP 文件导入</p>
        <p><small>保持目录结构，自动创建文件夹</small></p>
        <input id="zipInput" type="file" accept=".zip" style="display:none" onchange="handleZipImport(this.files)">
      </div>
      <div class="zip-prog" id="zipProg"><div class="zip-bar"><div class="zip-fill" id="zipFill"></div></div><div class="zip-txt" id="zipTxt"></div></div>
    </div>

    <div class="group">
      <div class="group-label">新建文件夹</div>
      <div class="group-box">
        <div class="row">
          <span class="row-label">名称</span>
          <input id="newFolderInput" type="text" placeholder="如：朋友圈创意九宫格/01_蛇年限定">
        </div>
        <div class="row row-tap" onclick="createFolder()"><span style="color:var(--accent)">创建</span></div>
      </div>
    </div>

    <div class="group">
      <div class="group-label">目录结构</div>
      <div class="group-box" id="treeBox"></div>
    </div>

    <div id="contentArea"></div>
  </div>
</div>

<!-- Action sheet for photo -->
<div class="sheet-bg" id="sheetBg" onclick="closeSheet()">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sheet-handle"></div>
    <div class="sheet-item" onclick="sheetRename()">重命名</div>
    <div class="sheet-item" onclick="sheetDownload()">下载原图</div>
    <div class="sheet-sep"></div>
    <div class="sheet-item danger" onclick="sheetDelete()">删除照片</div>
    <div class="sheet-sep"></div>
    <div class="sheet-cancel" onclick="closeSheet()">取消</div>
  </div>
</div>

<!-- Batch toolbar -->
<div class="batch" id="batchBar">
  <span class="batch-count" id="batchCount">0 已选</span>
  <button class="btn btn-sm btn-gray" onclick="selectAll()">全选</button>
  <button class="btn btn-sm btn-gray" onclick="sel.clear();renderPhotos()">取消</button>
  <button class="btn btn-sm btn-red" onclick="batchDelete()">删除</button>
  <button class="btn btn-sm btn-gray" onclick="saveOrder()">保存排序</button>
</div>

<div class="toast" id="toast"></div>

<script>
// Use relative URLs so preview/prod work without BASE_PATH/proxy special-casing
window.__BASE__ = '.';
window.__DOMAIN__ = '{{ domain }}';
window.__MAX_MB__ = {{ max_mb }};
</script>
<script src="{{ base }}/static/admin/app.js"></script>
</body></html>
