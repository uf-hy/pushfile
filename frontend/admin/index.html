<!doctype html>
<html lang="zh-CN"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>PushFile Admin</title>
<link rel="stylesheet" href="{{ base }}/static/admin/style.css">
</head><body>
<div class="page">
  <div class="nav">
    <span class="badge badge-left" id="versionBadge" title="当前版本">v--</span>
    <h1>PushFile Admin</h1>
    <button class="nav-btn" id="analyticsBtn" type="button" onclick="toggleAnalytics()" style="display:none">📊 统计</button>
    <span class="badge" id="connBadge">未连接</span>
  </div>
  <div class="build-meta" id="buildMeta">-- -- 构建</div>

  <!-- Login -->
  <div id="loginSection">
    <div class="group">
      <div class="group-label">连接</div>
      <div class="group-box">
        <div class="row">
          <span class="row-label">密码</span>
          <input id="secret" type="password" placeholder="输入管理密码">
        </div>
      </div>
    </div>
    <button class="btn btn-blue" type="button" onclick="connect()" style="margin-bottom:20px">连接</button>

    <div class="group">
      <div class="group-label">新建相册</div>
      <div class="group-box">
        <div class="row">
          <span class="row-label">名称</span>
          <input id="newTokenInput" type="text" placeholder="英文标识，如 trip-tokyo">
        </div>
      </div>
    </div>
    <button class="btn btn-gray" type="button" onclick="createToken()" style="margin-bottom:20px">创建相册</button>

    <div class="group" style="margin-top:24px">
      <div class="group-label">使用说明</div>
      <div class="group-box">
        <div class="steps">
          <div class="step"><div class="step-num">1</div><div class="step-text"><b>创建相册</b><span>输入英文名称作为标识，如 wedding2026、trip-tokyo</span></div></div>
          <div class="step"><div class="step-num">2</div><div class="step-text"><b>上传照片</b><span>选择相册后点击上传区域，支持 JPG/PNG/GIF/WebP</span></div></div>
          <div class="step"><div class="step-num">3</div><div class="step-text"><b>分享链接</b><span>复制链接发给朋友，打开即可查看和下载照片</span></div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main (hidden until connected) -->
  <div id="mainSection" style="display:none">
    <div id="analyticsPanel" style="display:none"></div>
    <div id="adminPanel">
    <div class="group">
      <div class="group-label">导入 ZIP</div>
      <div class="zip-zone" id="zipZone" onclick="openImportChooser(currentImportPath())">
        <p>📦 点击选择 ZIP，或直接拖入 ZIP / 文件夹</p>
        <p><small>保持目录结构，自动创建文件夹</small></p>
        <p class="import-flag"><small>✅ 当前版本支持：拖拽文件夹导入 / 选择文件夹导入</small></p>
        <div class="zip-actions">
          <button class="btn btn-sm btn-gray zip-btn" type="button" onclick="event.stopPropagation();openFolderPicker(currentImportPath())">选择文件夹</button>
        </div>
        <input id="zipInput" type="file" accept=".zip" style="display:none" onchange="handleZipImport(this.files)">
        <input id="folderInput" type="file" multiple webkitdirectory directory style="display:none" onchange="handleFolderImport(this.files)">
      </div>
      <div class="zip-prog" id="zipProg"><div class="zip-bar"><div class="zip-fill" id="zipFill"></div></div><div class="zip-txt" id="zipTxt"></div></div>
    </div>

    <div class="group">
      <div class="group-label">新建文件夹</div>
      <div class="group-box">
        <div class="row">
          <span class="row-label">名称</span>
          <input id="newFolderInput" type="text" placeholder="如：朋友圈创意九宫格/01_蛇年限定">
        </div>
        <div class="row row-tap" onclick="createFolder()"><span style="color:var(--accent)">创建</span></div>
      </div>
    </div>

    <div class="group">
      <div class="group-label">目录结构</div>
      <div class="group-box" id="treeBox"></div>
    </div>

    <div id="contentArea"></div>
    </div>
  </div>
</div>

<!-- Action sheet for photo -->
<div class="sheet-bg" id="sheetBg" onclick="closeSheet()">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sheet-handle"></div>
    <div class="sheet-item" onclick="sheetRename()">重命名</div>
    <div class="sheet-item" onclick="sheetDownload()">下载原图</div>
    <div class="sheet-sep"></div>
    <div class="sheet-item danger" onclick="sheetDelete()">删除照片</div>
    <div class="sheet-sep"></div>
    <div class="sheet-cancel" onclick="closeSheet()">取消</div>
  </div>
</div>

<!-- Batch toolbar -->
<div class="batch" id="batchBar">
  <span class="batch-count" id="batchCount">0 已选</span>
  <button class="btn btn-sm btn-gray" type="button" onclick="selectAll()">全选</button>
  <button class="btn btn-sm btn-gray" type="button" onclick="sel.clear();renderPhotos()">取消</button>
  <button class="btn btn-sm btn-red" type="button" onclick="batchDelete()">删除</button>
  <button class="btn btn-sm btn-gray" type="button" onclick="saveOrder()">保存排序</button>
</div>

<div class="toast" id="toast"></div>

<div class="modal-bg" id="importModalBg" onclick="closeImportModal()">
  <div class="modal-card" onclick="event.stopPropagation()">
    <div class="group" style="margin-bottom:16px">
      <div class="group-label">导入到文件夹</div>
      <div class="group-box">
        <div class="row row-stack">
          <div class="import-meta">来源文件</div>
          <div class="import-source" id="importSourceLabel">-</div>
        </div>
        <div class="row">
          <span class="row-label">名称</span>
          <input id="importNameInput" type="text" placeholder="新文件夹名称">
        </div>
        <div class="row row-stack">
          <div class="import-row-head">
            <span class="row-label" style="width:auto">位置</span>
            <button class="btn btn-sm btn-gray" type="button" onclick="focusImportDestination()">修改位置</button>
          </div>
          <input id="importDestInput" type="text" list="folderPathOptions" placeholder="默认导入到当前目录">
          <small class="import-tip">默认就是你当前打开的目录，也可以改成其他已存在目录</small>
        </div>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-gray" type="button" onclick="closeImportModal()">取消</button>
      <button class="btn btn-blue" type="button" onclick="confirmImportUpload()">确认导入</button>
    </div>
  </div>
</div>

<datalist id="folderPathOptions"></datalist>

<script>
// Use relative URLs so preview/prod work without BASE_PATH/proxy special-casing
window.__BASE__ = '{{ base }}';
window.__DOMAIN__ = '{{ domain }}';
window.__MAX_MB__ = Number('{{ max_mb }}');
window.__APP_VERSION__ = '{{ app_version }}' || '1.1.0';
window.__APP_BUILD_TIME__ = '{{ app_build_time }}' || '02-28 17:30';
</script>
<script src="{{ base }}/static/admin/app.js?v=20260228h2"></script>
</body></html>
